<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <!-- IE fix compitability -->
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title id='title'>SMYT-test of knowledge</title>

        <link rel="shortcut icon" type="image/x-icon" href="./img/favicon.ico">

        <!-- ** CSS ** -->
        <!-- base library -->
        <link rel="stylesheet" type="text/css" href="./extjs/resources/css/ext-all.css" />
        <link rel="stylesheet" type="text/css" href="./css/custom.css" />
        <!-- overrides to base library -->

        <!-- ** Javascript ** -->
        <!-- base library -->
        <script type="text/javascript" src="./extjs/adapter/ext/ext-base.js"></script>
        <script type="text/javascript" src="./extjs/ext-all-debug.js"></script>

        <!-- page specific -->

        <script type="text/javascript">
        Ext.BLANK_IMAGE_URL = './extjs/resources/images/default/s.gif';

        Ext.onReady(function(){
            //show tooltips
            Ext.QuickTips.init();

            // sample static data for the store
            var myData = [
                ['14-01-2012', 61, 71.72, 0.02,  0.03],
                ['13-02-2012', 10, 29.01, 0.42,  1.47],
                ['14-02-2012', 20, 83.81, 0.28,  0.34],
                ['15-02-2012', 30, 52.55, 0.01,  0.02],
                ['16-02-2012', 40, 64.13, 0.31,  0.49]
            ];


            // create the data store
            var store = new Ext.data.ArrayStore({
               fields: [
                    {name: 'startDate', type: 'date', dateFormat: 'd-m-Y'},
                    {name: 'loanTime', type: 'int'},
                    {name: 'price',      type: 'float'},
                    {name: 'change',     type: 'float'},
                    {name: 'pctChange',  type: 'float'},

               ]
            });
            console.log(store);

            // manually load local data
            store.loadData(myData);


            /**
             * Custom function used for column renderer
             * @param {Object} val
             */
            function daysChange(val) {
                if (val > 0) {
                    return val + ' ' + declOfNum(val, ['день', 'дня', 'дней']);
                }

                return val;
            }

            function declOfNum(number, titles)
            {
                cases = [2, 0, 1, 1, 1, 2];
                return titles[ (number%100>4 && number%100<20)? 2 : cases[(number%10<5)?number%10:5] ];
            }



            // create the Grid
            var grid = new Ext.grid.GridPanel({
                store: store,
                columns: [
                    {
                        header   : 'Дата',
                        width    : 85,
                        //sortable : true,
                        renderer : Ext.util.Format.dateRenderer('d.m.Y'),
                        dataIndex: 'startDate'
                    },
                    {
                        //id       :'company',
                        header   : 'Срок',
                        width    : 60,
                        //sortable : true,
                        renderer : daysChange,
                        dataIndex: 'loanTime'
                    },
                    {
                        header   : 'Price',
                        width    : 75,
                        sortable : true,
                        //renderer : 'usMoney',
                        dataIndex: 'price'
                    },
                    {
                        header   : 'Change',
                        width    : 75,
                        sortable : true,

                        dataIndex: 'change'
                    },
                    {
                        header   : '% Change',
                        width    : 75,
                        sortable : true,
                        //renderer : pctChange,
                        dataIndex: 'pctChange'
                    },
                    {
                        xtype: 'actioncolumn',
                        width: 80,


                        items: [{
                            icon   : './img/print.png',
                            tooltip: 'Печать',
                            iconCls: 'my-icon',
                            handler : function() {
                                window.open (
                                  'about:blank',
                                  '_blank'
                                );
                            }
                        },
                        {
                            icon   : './img/docs.png',
                            tooltip: 'Список документов',
                            iconCls: 'my-icon',
                            handler : function() {
                                window.open (
                                  'about:blank',
                                  '_blank'
                                );
                            }
                        },
                        {
                            icon   : './img/close.png',
                            tooltip: 'Удалить',
                            iconCls: 'my-icon',
                            handler : function(grid, rowIndex, colIndex) {
                                Ext.MessageBox.buttonText.yes = "Да";
                                Ext.MessageBox.buttonText.no = "Нет";
                                Ext.MessageBox.confirm('Удаление', 'Вы действительно хотите удалить эту запись?', function(btn) {
                                    if (btn === 'yes') {
                                        var rec = store.getAt(rowIndex);
                                        //console.log(rec);
                                        store.remove(rec);
                                    }
                                });
                            }
                        }]
                    },
                ],
                stripeRows: true,
                //autoExpandColumn: 'company',
                height: 350,
                width: 600,
                cls: 'my-panel',
                title: 'История займов по заемщику'
                //renderTo: Ext.getBody()
            });


            //do a Viewport
            new Ext.Viewport({
                layout: {
                    type: 'vbox',
                    align: 'center',
                    pack: 'center'
                },
                items:[grid]
            });

		    // grid.render(document.body);

        }); //end onReady
        </script>

    </head>
    <body>
    </body>
</html>